
module.exports = icon_button

// CSS Boiler Plat
const sheet = new CSSStyleSheet
const theme = get_theme()
sheet.replaceSync(theme)



var id = 0

// opts - icon/img src
function icon_button (opts, protocol) {

    const name = `icon_button_${id++}`
    let {src, src_active} = opts
    let parent_args, message

    const el = document.createElement('div')
    const shadow = el.attachShadow({mode:'closed'})
    shadow.innerHTML = `
        <div class="icon_btn">
            ${src}
        </div>
        <style>${get_theme()}</style>
    `
    const icon_button = shadow.querySelector(".icon_btn")

    //protocol
    if(protocol){
        parent_args = protocol(listen, name)
        message = {
            head: {by:'icon_button', to:parent_args[1], mid:0},
            type: 'handle_page_change',
        }
        function listen(message){
            const {head,  refs, type, data, meta} = message
            const [by, to, id] = head
            ;(data === 'DEFAULT') ? icon_button.classList.add('active') : icon_button.classList.remove('active')
        }
    }

    // Toggle Icon
    if(src_active){
        let activeState = true
        icon_button.onclick = (e) =>{
            ;icon_button.innerHTML = (activeState)? src_active : src
            activeState = !activeState
            toggle_class(e)
        }
    }else{
        icon_button.onclick = (e) => toggle_class(e)
    }

    shadow.adoptedStyleSheets = [sheet]
    return el

    // function toggle_class(e){
    //     if(protocol)
    //     {
    //         message['data'] = 'DEFAULT'
    //         parent_args[0](message)
    //     }
    //     else{
    //         let selector = e.target.classList
    //         ;( selector.contains('active') ) ? selector.remove('active') : selector.add('active')
    //     }
    // }

    function toggle_class(e) {
        if (protocol) {
            message['data'] = 'DEFAULT'
            parent_args[0](message)
        } else {
            e.target.classList.toggle('active');
        }
    }
}



function get_theme(){
    return`
        .icon_btn{
            display:flex;
            justify-content: center;
            align-items:center;
            height:40px;
            box-sizing:border-box;
            aspect-ratio:1/1;
            cursor:pointer;
            border: 1px solid var(--primary_color);
            background-color: var(--bg_color);
        }
        .icon_btn svg{
            height:25px;
            width: 25px;
            pointer-events:none;
        }
        .icon_btn svg *{
            pointer-events:none;
        }
        .icon_btn.active{
            background-color: var(--ac-2)
        }
    `
}